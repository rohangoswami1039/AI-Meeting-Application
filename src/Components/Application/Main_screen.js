import 'bootstrap/dist/css/bootstrap.min.css';
import './Style/Main_screen.css'
import { useEffect, useState } from 'react';
import { styled } from 'styled-components';
import Colors from './constants/theme'
import RecentList from './RecentList'; 
import ComponentDisplay from './ComponentDisplay';
import { useNavigate } from 'react-router-dom';
import { auth, database } from '../../firebase';
import { collection, getDocs, onSnapshot } from 'firebase/firestore';

function Main_screen() {
  const navigator = useNavigate()
  const [showNav, setShowNav] = useState(true);
  const [selectedItem, setSelectedItem] = useState(null);
  const [meetings, setMeetings] = useState([]);
  const [componentKey, setComponentKey] = useState(0);


  useEffect(() => {
    const docRef = collection(database, 'Users', `${auth.currentUser.uid}`, 'meetings');
    
    const unsubscribe = onSnapshot(docRef, (querySnapshot) => {
      const meetingsData = querySnapshot.docs.map(doc => doc.data());
      setMeetings(meetingsData);
    });

    return () => unsubscribe();
  }, []);

  console.log(meetings)
  //code for fetching the meetings id and seting it to items 
  
const handleItemClick = (item) => {
  setSelectedItem(item);
  setComponentKey(componentKey + 1);
};

  const toggleNav = () => {
    setShowNav(!showNav);
  };

  const Nav = styled.div`
    background-color: ${Colors.light};
    height: 100vh;
    width: 70px;
    display: ${showNav?'block':'none'};
    transition: width 0.3s ease-in-out;
    width: ${showNav ? '70px' : '0'};
    overflow: auto;
`

  return (
    <div className="container-fluid">
      <div className="row">
      <Nav className={`Nav ${showNav ? '' : 'hide'}`}>
      <div className={`col-md-3 col-lg-2 sidebar`} id="sidebar">
          
          {/* Navigation container  */}
          <div className='icons_container-top'>
           
            {/** back button icon */}
            <div className='icon' onClick={toggleNav} >
              <svg width="30" height="30" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M35 42.5L22.5 30L35 17.5" stroke="white" strokeWidth="3.75" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
            </div>
            {/** */}


            {/** Home icons */}
            <div className='icon'>
              <svg width="30" height="30" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="Home">
                <path id="Vector" fillRule="evenodd" clipRule="evenodd" d="M6.97938 18.9647C6.71686 19.5983 6.66683 19.9222 6.66683 20V33.3363C6.66683 34.2548 7.41103 35 8.3335 35H13.3335V25C13.3335 23.159 14.8259 21.6667 16.6668 21.6667H23.3335C25.1745 21.6667 26.6668 23.159 26.6668 25V35H31.6668C32.5893 35 33.3335 34.2548 33.3335 33.3363V20C33.3335 19.9222 33.2835 19.5983 33.021 18.9647C32.7772 18.376 32.4073 17.6543 31.9247 16.8375C30.9608 15.2063 29.6085 13.3 28.0948 11.4836C26.5777 9.66312 24.94 7.98281 23.4172 6.77422C22.656 6.17006 21.9562 5.71012 21.3427 5.40732C20.7152 5.09769 20.2737 4.99999 20.0002 4.99999C19.7267 4.99999 19.2852 5.09769 18.6577 5.40732C18.0442 5.71012 17.3443 6.17006 16.5831 6.77422C15.0603 7.98281 13.4226 9.66312 11.9055 11.4836C10.3919 13.3 9.03951 15.2063 8.07566 16.8375C7.59296 17.6543 7.22325 18.376 6.97938 18.9647ZM17.1825 2.41817C18.059 1.98562 19.0237 1.66666 20.0002 1.66666C20.9767 1.66666 21.9413 1.98562 22.8178 2.41817C23.7082 2.85756 24.61 3.46534 25.4893 4.16326C27.2478 5.55884 29.0477 7.42019 30.6555 9.34969C32.267 11.2833 33.727 13.3353 34.7945 15.1417C35.3273 16.0436 35.778 16.9103 36.1005 17.689C36.4043 18.4225 36.6668 19.2445 36.6668 20V33.3363C36.6668 36.0998 34.4263 38.3333 31.6668 38.3333H26.6668C24.8258 38.3333 23.3335 36.841 23.3335 35V25H16.6668V35C16.6668 36.841 15.1744 38.3333 13.3335 38.3333H8.3335C5.57406 38.3333 3.3335 36.0998 3.3335 33.3363V20C3.3335 19.2445 3.59596 18.4225 3.89986 17.689C4.2224 16.9103 4.67298 16.0436 5.20591 15.1417C6.27331 13.3353 7.73341 11.2833 9.3448 9.34969C10.9527 7.42019 12.7525 5.55884 14.5109 4.16326C15.3903 3.46534 16.2922 2.85756 17.1825 2.41817Z" fill="white"/>
               </g>
              </svg>
            </div>
            {/** */}
        
            {/* Join Meeting Icon */}
            <div onClick={()=>{navigator('/meeting')}} className='icon'>
              <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20 1C21.6569 1 23 2.34315 23 4V14C23 15.6569 21.6569 17 20 17H13.562L18.6402 21.2318C19.0645 21.5853 19.1218 22.2159 18.7682 22.6402C18.4147 23.0645 17.7841 23.1218 17.3598 22.7682L13 19.135V22C13 22.5523 12.5523 23 12 23C11.4477 23 11 22.5523 11 22V19.135L6.64018 22.7682C6.21591 23.1218 5.58534 23.0645 5.23178 22.6402C4.87821 22.2159 4.93554 21.5853 5.35982 21.2318L10.438 17H4C2.34315 17 1 15.6569 1 14V4C1 2.34315 2.34315 1 4 1H20ZM20 3C20.5523 3 21 3.44772 21 4V14C21 14.5523 20.5523 15 20 15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H20Z" fill="white"/>
              </svg>
            </div>

            {/* Join Meeting Icon */}
            <div onClick={()=>{navigator('/create-meeting')}} className='icon'>
            <svg width="30" height="30" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="11.997" d="M16.869 60.973v53.832c.048 12.173 10.87 21.965 24.072 21.925h85.406c2.42 0 4.385-1.797 4.385-3.978V78.92c-.064-12.164-10.887-21.965-24.073-21.917H21.237c-2.412 0-4.368 1.79-4.368 3.97zm119.294 21.006 35.27-23.666c3.06-2.332 5.432-1.749 5.432 2.468v72.171c0 4.8-2.9 4.217-5.432 2.468l-35.27-23.618V81.98z"/>
            </svg>
            </div>


          </div>
          {/** */}
          
          {/** Icon container bottom */}
          {/*settings icon */}
          <div className='icons-container-bottom'>
             <div className='icon' >
                <svg width="30" height="30" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.5 3.33333L23.3268 3.22997C23.2748 2.81295 22.9203 2.5 22.5 2.5V3.33333ZM17.5 3.33333V2.5C17.0797 2.5 16.7252 2.81295 16.6732 3.22997L17.5 3.33333ZM22.9578 6.9959L22.131 7.09925C22.1745 7.44748 22.4315 7.73112 22.7737 7.80865L22.9578 6.9959ZM27.1028 8.71397L26.6583 9.41883C26.9552 9.60603 27.3373 9.58722 27.6145 9.37177L27.1028 8.71397ZM30.0173 6.4471L30.6067 5.85785C30.3095 5.56067 29.8375 5.53128 29.5057 5.78932L30.0173 6.4471ZM33.5528 9.98263L34.2107 10.4943C34.4687 10.1625 34.4393 9.69057 34.1422 9.39338L33.5528 9.98263ZM31.286 12.8972L30.6282 12.3856C30.4128 12.6626 30.394 13.0449 30.5812 13.3417L31.286 12.8972ZM33.0042 17.0422L32.1913 17.2263C32.2688 17.5685 32.5525 17.8255 32.9007 17.869L33.0042 17.0422ZM36.6667 17.5H37.5C37.5 17.0797 37.187 16.7252 36.77 16.6732L36.6667 17.5ZM36.6667 22.5L36.77 23.3268C37.187 23.2748 37.5 22.9203 37.5 22.5H36.6667ZM33.0042 22.9578L32.9007 22.131C32.5525 22.1745 32.2688 22.4315 32.1913 22.7737L33.0042 22.9578ZM31.286 27.1028L30.5812 26.6583C30.394 26.9552 30.4128 27.3375 30.6282 27.6145L31.286 27.1028ZM33.5528 30.0173L34.1422 30.6067C34.4393 30.3095 34.4687 29.8375 34.2107 29.5057L33.5528 30.0173ZM30.0173 33.5528L29.5057 34.2107C29.8375 34.4687 30.3095 34.4393 30.6067 34.1422L30.0173 33.5528ZM27.1028 31.286L27.6145 30.6282C27.3373 30.4128 26.9552 30.394 26.6583 30.5812L27.1028 31.286ZM22.9578 33.0042L22.7737 32.1913C22.4315 32.2688 22.1745 32.5525 22.131 32.9007L22.9578 33.0042ZM22.5 36.6667V37.5C22.9203 37.5 23.2748 37.187 23.3268 36.77L22.5 36.6667ZM17.5 36.6667L16.6732 36.77C16.7252 37.187 17.0797 37.5 17.5 37.5V36.6667ZM17.0422 33.0042L17.869 32.9007C17.8255 32.5525 17.5685 32.2688 17.2263 32.1913L17.0422 33.0042ZM12.8972 31.286L13.3417 30.5812C13.0449 30.394 12.6626 30.4128 12.3856 30.6282L12.8972 31.286ZM9.98265 33.5528L9.3934 34.1422C9.69058 34.4393 10.1625 34.4687 10.4943 34.2107L9.98265 33.5528ZM6.44712 30.0173L5.78933 29.5057C5.5313 29.8375 5.56068 30.3095 5.85787 30.6067L6.44712 30.0173ZM8.71398 27.1028L9.37178 27.6145C9.58723 27.3375 9.60605 26.9552 9.41885 26.6583L8.71398 27.1028ZM6.9959 22.9578L7.80865 22.7737C7.73112 22.4315 7.44748 22.1745 7.09925 22.131L6.9959 22.9578ZM3.33333 22.5H2.5C2.5 22.9203 2.81295 23.2748 3.22997 23.3268L3.33333 22.5ZM3.33333 17.5L3.22997 16.6732C2.81295 16.7252 2.5 17.0797 2.5 17.5H3.33333ZM6.9959 17.0422L7.09925 17.869C7.44748 17.8255 7.73112 17.5685 7.80865 17.2263L6.9959 17.0422ZM8.71398 12.8972L9.41885 13.3417C9.60605 13.0449 9.58723 12.6626 9.37178 12.3856L8.71398 12.8972ZM6.44712 9.98265L5.85787 9.39338C5.56068 9.69057 5.5313 10.1625 5.78932 10.4943L6.44712 9.98265ZM9.98265 6.44712L10.4943 5.78932C10.1625 5.5313 9.69057 5.56068 9.3934 5.85785L9.98265 6.44712ZM12.8972 8.71398L12.3856 9.37177C12.6626 9.58722 13.0449 9.60605 13.3417 9.41883L12.8972 8.71398ZM17.0422 6.9959L17.2263 7.80865C17.5685 7.73112 17.8255 7.44748 17.869 7.09925L17.0422 6.9959ZM22.5 2.5H17.5V4.16667H22.5V2.5ZM23.7847 6.89253L23.3268 3.22997L21.6732 3.4367L22.131 7.09925L23.7847 6.89253ZM27.5473 8.00912C26.2132 7.16765 24.7282 6.54242 23.1418 6.18315L22.7737 7.80865C24.1717 8.12528 25.481 8.67638 26.6583 9.41883L27.5473 8.00912ZM27.6145 9.37177L30.529 7.1049L29.5057 5.78932L26.5912 8.05618L27.6145 9.37177ZM29.4282 7.03637L32.9637 10.5719L34.1422 9.39338L30.6067 5.85785L29.4282 7.03637ZM32.8952 9.47102L30.6282 12.3856L31.9438 13.4088L34.2107 10.4943L32.8952 9.47102ZM33.8168 16.8582C33.4577 15.2719 32.8323 13.7869 31.9908 12.4526L30.5812 13.3417C31.3237 14.519 31.8747 15.8283 32.1913 17.2263L33.8168 16.8582ZM36.77 16.6732L33.1075 16.2153L32.9007 17.869L36.5633 18.3268L36.77 16.6732ZM37.5 22.5V17.5H35.8333V22.5H37.5ZM33.1075 23.7847L36.77 23.3268L36.5633 21.6732L32.9007 22.131L33.1075 23.7847ZM31.9908 27.5473C32.8323 26.2132 33.4577 24.7282 33.8168 23.1418L32.1913 22.7737C31.8747 24.1717 31.3237 25.481 30.5812 26.6583L31.9908 27.5473ZM34.2107 29.5057L31.9438 26.5912L30.6282 27.6145L32.8952 30.529L34.2107 29.5057ZM30.6067 34.1422L34.1422 30.6067L32.9637 29.4282L29.4282 32.9637L30.6067 34.1422ZM26.5912 31.9438L29.5057 34.2107L30.529 32.8952L27.6145 30.6282L26.5912 31.9438ZM23.1418 33.8168C24.7282 33.4577 26.2132 32.8323 27.5473 31.9908L26.6583 30.5812C25.481 31.3237 24.1717 31.8747 22.7737 32.1913L23.1418 33.8168ZM23.3268 36.77L23.7847 33.1075L22.131 32.9007L21.6732 36.5633L23.3268 36.77ZM17.5 37.5H22.5V35.8333H17.5V37.5ZM16.2153 33.1075L16.6732 36.77L18.3268 36.5633L17.869 32.9007L16.2153 33.1075ZM12.4527 31.9908C13.7869 32.8323 15.2719 33.4577 16.8582 33.8168L17.2263 32.1913C15.8283 31.8747 14.519 31.3237 13.3417 30.5812L12.4527 31.9908ZM10.4943 34.2107L13.4088 31.9438L12.3856 30.6282L9.47103 32.8952L10.4943 34.2107ZM5.85787 30.6067L9.3934 34.1422L10.5719 32.9637L7.03638 29.4282L5.85787 30.6067ZM8.0562 26.5912L5.78933 29.5057L7.10492 30.529L9.37178 27.6145L8.0562 26.5912ZM6.18315 23.1418C6.54242 24.7282 7.16765 26.2132 8.00912 27.5473L9.41885 26.6583C8.6764 25.481 8.12528 24.1717 7.80865 22.7737L6.18315 23.1418ZM3.22997 23.3268L6.89253 23.7847L7.09925 22.131L3.4367 21.6732L3.22997 23.3268ZM2.5 17.5V22.5H4.16667V17.5H2.5ZM6.89253 16.2153L3.22997 16.6732L3.4367 18.3268L7.09925 17.869L6.89253 16.2153ZM8.00912 12.4527C7.16765 13.7869 6.54242 15.2719 6.18315 16.8582L7.80865 17.2263C8.12528 15.8283 8.67638 14.519 9.41885 13.3417L8.00912 12.4527ZM5.78932 10.4943L8.05618 13.4088L9.37178 12.3856L7.10492 9.47103L5.78932 10.4943ZM9.3934 5.85785L5.85787 9.39338L7.03637 10.5719L10.5719 7.03637L9.3934 5.85785ZM13.4088 8.05618L10.4943 5.78932L9.47103 7.1049L12.3856 9.37177L13.4088 8.05618ZM16.8582 6.18315C15.2719 6.54242 13.7869 7.16765 12.4527 8.00912L13.3417 9.41883C14.519 8.67638 15.8283 8.12528 17.2263 7.80865L16.8582 6.18315ZM16.6732 3.22997L16.2153 6.89253L17.869 7.09925L18.3268 3.4367L16.6732 3.22997Z" fill="white"/>
                <path d="M20.0002 26.6667C23.6821 26.6667 26.6668 23.6819 26.6668 20C26.6668 16.3181 23.6821 13.3333 20.0002 13.3333C16.3183 13.3333 13.3335 16.3181 13.3335 20C13.3335 23.6819 16.3183 26.6667 20.0002 26.6667Z" stroke="white" strokeWidth="2.5" strokeLinejoin="round"/>
                </svg>
            </div>
            {/** */}

            {/* Profile Icon */}
            <div className='icon' onClick={()=>{navigator('/Profile')}}>
                <svg width="30" height="30" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path opacity="0.4" d="M20.2013 21.3C20.0847 21.2833 19.9347 21.2833 19.8013 21.3C16.868 21.2 14.5347 18.8 14.5347 15.85C14.5347 12.8333 16.968 10.3833 20.0013 10.3833C23.018 10.3833 25.468 12.8333 25.468 15.85C25.4513 18.8 23.1347 21.2 20.2013 21.3Z" stroke="white" strokeWidth="3.75" strokeLinecap="round" strokeLinejoin="round"/>
                <path opacity="0.34" d="M31.2328 32.3002C28.2662 35.0168 24.3328 36.6668 19.9995 36.6668C15.6661 36.6668 11.7328 35.0168 8.76611 32.3002C8.93278 30.7335 9.93278 29.2002 11.7161 28.0002C16.2828 24.9668 23.7495 24.9668 28.2828 28.0002C30.0662 29.2002 31.0662 30.7335 31.2328 32.3002Z" stroke="white" strokeWidth="3.75" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M20.0002 36.6667C29.2048 36.6667 36.6668 29.2047 36.6668 20C36.6668 10.7953 29.2048 3.33334 20.0002 3.33334C10.7954 3.33334 3.3335 10.7953 3.3335 20C3.3335 29.2047 10.7954 36.6667 20.0002 36.6667Z" stroke="white" strokeWidth="3.75" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
            </div>
            {/** */}
          </div>
      </div>
      </Nav>

        {/** Recent and search button area */}
        <div className={`col-md-2 col-lg-3 recents`}>
        <Recents_Div>
          {showNav===false && <div className='toggle-button' onClick={toggleNav}>
          {/*Hangburger Icon */}
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 7L4 7" stroke="#1C274C" strokeWidth="1.5" strokeLinecap="round"/>
            <path opacity="0.5" d="M20 12L4 12" stroke="#1C274C" strokeWidth="1.5" strokeLinecap="round"/>
            <path d="M20 17L4 17" stroke="#1C274C" strokeWidth="1.5" strokeLinecap="round"/>
          </svg>
          </div>}
          {/** */}
            <div className='Search'>
            <Search_Div>
              <div className='search_pannel'>
              <div className='search_icon'>
                <svg width="25" height="25" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.16667 5C11.4678 5 13.3333 6.86548 13.3333 9.16667M13.8823 13.8791L17.5 17.5M15.8333 9.16667C15.8333 12.8486 12.8486 15.8333 9.16667 15.8333C5.48477 15.8333 2.5 12.8486 2.5 9.16667C2.5 5.48477 5.48477 2.5 9.16667 2.5C12.8486 2.5 15.8333 5.48477 15.8333 9.16667Z" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
              </div>
              <input  className='Search_input' placeholder='Search...'/>
              </div>
            </Search_Div>
            </div>
            <Recent_Text>Recents</Recent_Text>

            <div className={'recents_container scroll-container'} style={{position:'relative',top:'50px',overflow:'auto',maxHeight:'80vh'}}>
              <RecentList selectedItem={selectedItem} items={meetings} onItemClick={handleItemClick} />
            </div>
            
            
          </Recents_Div>
        </div>
        <div className={'col'}>
         {selectedItem && <ComponentDisplay  key={componentKey} selectedItem={selectedItem} />}
        </div>
    </div>
    </div>
  );
}

export default Main_screen;
const Recents_Div = styled.div`
  height:100vh;
  margin-left: 5px;
  background-color:${Colors.secondary_light};
`
const Search_Div = styled.div`
    width: 80%;
    position: relative;
    left:25px;
    top:25px;
    height: 37px;
    border-radius: 25px;
    background-color:${Colors.secondary_dark}
`
const Recent_Text = styled.h2`
    position: relative;
    top: 40px;
    left: 10px;
    font-size:x-large;
    color: ${Colors.secondary_dark};
`

